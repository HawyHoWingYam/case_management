本阶段我们将构建应用的第一个可用功能，并同步建立起一套围绕该功能开发的自动化流程。

#### **1. 后端 (Nest.js): 用户认证体系**

**目标**：建立安全、可扩展的认证 API，并实践标准化的 Git 协作流程。

- **1.1. Git 分支**: 从 `develop` 分支创建新的功能分支: `git checkout -b feature/backend-auth`。
    
- **1.2. 增强用户模型 (Prisma)**: 在 `prisma/schema.prisma` 的 `User` 模型中添加 `password` 字段。
    
- **1.3. 创建认证模块 (`AuthModule`)**:
    
    - 安装依赖: `npm install @nestjs/passport passport passport-local @nestjs/jwt passport-jwt bcrypt` 及 `@types/*`。
        
    - **登录逻辑**: 创建 `POST /api/auth/login` 端点，验证凭据并返回 JWT。
        
    - **JWT 策略**: 配置 `JwtStrategy` 用于解析和验证 Token。
        
- **1.4. 创建角色守卫 (`RolesGuard`)**: 创建可重用的 `RolesGuard` 用于保护需要特定角色权限的端点。
    
- **1.5. 创建用户种子数据 (Seeding)**: 使用 Prisma seeding 功能创建覆盖所有角色的测试用户。
    
- **1.6. Git 提交与合并**:
    
    - 完成开发后，将代码提交: `git commit -m "feat(auth): implement user authentication module"`。
        
    - 创建 Pull Request (PR) 到 `develop` 分支，并在 GitHub 上请求团队成员进行代码审查 (Code Review)。
        

#### **2. 前端 (Next.js): 登录与页面保护**

**目标**：构建用户登录界面，并建立前端的认证状态管理和路由保护。

- **2.1. Git 分支**: `git checkout -b feature/frontend-auth`。
    
- **2.2. 创建登录页面 (`/login`)**: 使用 `shadcn/ui`, `react-hook-form`, `zod` 构建响应式登录表单。
    
- **2.3. 实现全局认证状态管理**: 使用 `zustand` 创建 `authStore` 管理用户登录状态。
    
- **2.4. 实现登录/登出逻辑**: 调用后端 API，成功后更新 `authStore` 并重定向页面。
    
- **2.5. 创建路由保护**: 使用 Next.js 中间件或高阶组件 (HOC) 保护需要登录才能访问的页面。
    
- **2.6. Git 提交与合并**: 完成后，提交代码并创建 PR 到 `develop` 分支进行审查。
    

#### **3. 后端 (Nest.js): 案件创建 API**

**目标**：开发创建新案件的核心 API。

- **3.1. Git 分支**: `git checkout -b feature/backend-case-creation`。
    
- **3.2. 创建案件模块 (`CasesModule`)**: 创建 `POST /api/cases` 端点，并使用 `RolesGuard` 保护，仅限 `Clerk` 访问。
    
- **3.3. 实现案件创建服务**: 编写业务逻辑，将案件初始状态设为 `New` 并存入数据库。
    
- **3.4. 实现文件上传 (本地模拟 S3)**: 在 `docker-compose.yml` 中添加 `MinIO` 服务，并创建 `FilesModule` 用于处理文件上传。
    
- **3.5. Git 提交与合并**: 完成后，提交代码并创建 PR 到 `develop` 分支。
    

#### **4. 前端 (Next.js): 案件创建表单**

**目标**：为 Clerk 提供功能完善的界面来创建新案件。

- **4.1. Git 分支**: `git checkout -b feature/frontend-case-creation`。
    
- **4.2. 创建"新案件"页面 (`/cases/new`)**: 构建与 `Case` 模型匹配的完整表单，页面入口根据用户角色条件性显示。
    
- **4.3. 开发文件上传组件**: 创建支持拖放的文件上传组件，调用后端文件上传 API。
    
- **4.4. 实现表单提交逻辑**: 收集表单数据，调用后端 `POST /api/cases` API，并处理成功/失败的反馈。
    
- **4.5. Git 提交与合并**: 完成后，提交代码并创建 PR 到 `develop` 分支。
    

#### **5. 自动化与开发运维 (Automation & DevOps)**

**目标**：建立初步的持续集成流程，提升开发效率和代码质量。

- **5.1. GitHub Actions: 持续集成 (CI)**:
    
    - **目标**: 在代码合并到 `develop` 分支前，自动进行质量检查。
        
    - **创建工作流文件**: 在项目根目录创建 `.github/workflows/ci.yml`。
        
    - **配置工作流**:
        
        - **触发条件**: `on: pull_request` (当有 PR 指向 `develop` 分支时触发)。
            
        - **任务 (Job)**: 定义一个 `build-and-test` 任务。
            
        - **步骤 (Steps)**: 任务将依次执行：拉取代码 -> 设置 Node.js 环境 -> 安装前后端依赖 (`npm ci`) -> 运行代码风格检查 (`npm run lint`) -> 运行单元测试 (`npm run test`)。
            
    - **强制检查**: 在 GitHub 仓库的分支保护规则中，设置此 CI 检查为"必须通过"，才能合并 PR。

这个更新后的计划专注于核心的前后端开发和持续集成流程，确保我们建立起高效、规范的开发流程。完成后即可为 **阶段 2** 做准备。