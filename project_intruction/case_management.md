好的，這份計畫書已根據您的最新技術選擇（前端使用 Next.js，後端使用 NestJS）進行全面更新。這是一個非常強大且現代化的組合。

---

### **專案整體方案 - Next.js & NestJS 修訂版**

本方案旨在將您的設計圖和需求，轉化為一個基於 Next.js 和 NestJS 技術堆疊、功能完整的響應式 Web 應用程式。我們將採用分階段的敏捷開發模式，確保每個階段都有可交付的成果。

---

#### **階段 0: 基礎建設與環境設定 (Foundation & Setup)**

此階段的目標是搭建專案所需的所有技術基礎架構，為後續開發鋪路。

- **步驟 0.1: 建立技術堆疊與開發環境**
    
    - **前端框架:** 採用 **Next.js** 框架來建構互動式且響應式的使用者介面(UI)。這將提供伺服器端渲染(SSR)、靜態網站生成(SSG)和檔案式路由等優勢，大幅提升 SEO 效能和使用者體驗。
        
    - **後端框架:** 採用 **NestJS** 框架來開發後端應用程式介面(API)。其基於 TypeScript 的模組化架構（模組、控制器、服務）將確保後端程式碼的高度結構化、可擴展性和可維護性。
        
    - **版本控制:** 初始化 Git 儲存庫，用於專案程式碼的版本控制與協同作業。
        
- **步驟 0.2: 設定雲端檔案儲存 (Cloud Storage)**
    
    - 設定一個雲端儲存服務 ( AWS S3 )，建立一個儲存桶(Bucket)，專門用於存放與案件相關的上傳檔案。
        
- **步驟 0.3: 建立資料庫與 ORM (Database & ORM)**
    
    - 採用標準的關聯式資料庫 ( PostgreSQL )。
        
    - 在 NestJS 專案中整合一個物件關聯對映(ORM)工具，如 **TypeORM** 或 **Prisma**，用來定義資料模型(Schema)並高效、安全地操作資料庫。
        
    - 根據您的實體關係圖(ERD)，使用 ORM 建立三個核心資料實體：`User`, `Case`, `Case_Log`。
        
- **步驟 0.4: 定義資料庫關係 (Database Relationships)**
    
    - 透過 ORM 的裝飾器(Decorators)或設定檔，定義資料實體之間的關係，例如 `User` 和 `Case` 之間的多對多指派關係，以及 `Case` 和 `Case_Log` 之間的一對多關係。
        
- **步驟 0.5: 準備測試資料**
    
    - 在 `User` 表中手動建立幾筆測試用的使用者資料，應包含全部三種角色 (Clerk, Chair, Caseworker)。
        

---

#### **階段 1: 核心 App 開發 (MVP - Clerk & Chair 功能)**

此階段的目標是建立一個最小可行性產品(MVP)，讓核心的案件創建和審核流程能夠運作。

- **步驟 1.1: 初始化 Next.js 應用程式**
    
    - 使用 Next.js 建立前端專案，並規劃好基於其檔案系統的路由結構 (例如使用 App Router)。
        
- **步驟 1.2: 設計統一且響應式的主畫面**
    
    - 設計一個統一的主畫面(儀表板)，其版面配置能自動適應電腦和手機螢幕。此畫面將包含一個案件列表元件。
        
    - **實現角色過濾:** 畫面元件將根據從 NestJS API 獲取的當前登入使用者角色，來動態決定是否渲染特定按鈕（如「新建案件」）。
        
- **步驟 1.3: 開發「新建案件」功能 (Clerk)**
    
    - 利用 Next.js 的檔案路由，建立一個案件輸入頁面。
        
    - 使用 React 元件設計表單，讓 Clerk 可以填寫案件的詳細資訊。
        
    - **實現文件上傳:** 開發一個上傳元件，該元件將檔案發送到 NestJS 的指定 API 端點，由後端負責將檔案存儲到雲端儲存。
        
    - **提交按鈕的邏輯:** 點擊後，前端將表單資料打包，呼叫 NestJS API，由後端進行驗證並寫入資料庫，初始狀態 `Status` 設為 "New"。
        
- **步驟 1.4: 開發「案件列表與審核」功能 (Chair)**
    
    - 在主畫面的案件列表元件中，透過呼叫 NestJS API 來獲取所有狀態為 "New" 或 "Pending Review" 的案件。
        
    - Chair 點擊任一案件後，Next.js 將導航到一個動態路由頁面 (`/cases/[caseId]`)，顯示從後端獲取的案件詳細資訊。
        
    - 在詳細頁面中為 Chair 提供「指派」、「退回」等操作按鈕。
        

---

#### **階段 2: 工作流程與邏輯實現 (NestJS 後端 API)**

此階段將專注於在 NestJS 中實現所有業務邏輯，將其封裝在結構化的控制器(Controllers)與服務(Services)中。

- **步驟 2.1: 案件提交與狀態更新邏輯**
    
    - 在 `CaseController` 中建立一個用於「新建案件」的 API 端點。此端點將呼叫 `CaseService` 中的方法，該方法負責：驗證資料、將案件存入資料庫、立即將狀態更新為 "Pending Review"、處理檔案上傳，並在 `Case_Log` 表中新增第一筆日誌。
        
- **步驟 2.2: 案件指派與通知 API**
    
    - 在 `CaseController` 中建立一個「指派案件」的端點 (例如 `@Put(':caseId/assign')`)。`CaseService` 將負責更新案件的 `AssignedCaseworkerID` 和 `Status`，並整合郵件服務發送通知郵件。
        
- **步驟 2.3: Caseworker 接受案件 API (含業務規則)**
    
    - 在 `CaseController` 中建立「接受案件」的端點 (例如 `@Post(':caseId/accept')`)。`CaseService` 在執行更新前，會先實現業務規則檢查（查詢該員工處理中的案件數量），如果超過上限則返回錯誤訊息，否則更新案件狀態並記錄日誌。
        
- **步驟 2.4: 請求完成與通知 API**
    
    - 在 `CaseController` 中建立「請求完成」的端點。`CaseService` 將負責更新案件狀態，並觸發給 Chair 的郵件通知。
        

---

#### **階段 3: Caseworker 功能與進階介面開發**

此階段將完成所有角色的前端介面，並將其與 NestJS 後端 API 完全對接。

- **步驟 3.1: 開發 Caseworker 個人化視圖**
    
    - 在 Next.js 的主畫面上，根據登入者角色呼叫不同的 NestJS API 端點，以獲取 Caseworker 專屬的案件列表。
        
- **步驟 3.2: 實現 Caseworker 案件操作**
    
    - 在 Next.js 的案件詳細資訊頁面，為 Caseworker 添加「Accept Case」和「Request Case Completion」按鈕，並分別綁定對應的 NestJS API 請求。
        
- **步驟 3.3: 實現 Chair 最終審批功能**
    
    - 在案件詳細資訊頁面，為 Chair 添加「Approve Case Completion」和「Reject Case」按鈕，分別綁定後端的批准與拒絕 API。
        
- **步驟 3.4: 實現手動添加日誌功能**
    
    - 開發一個備註輸入元件，點擊按鈕後，將備註內容發送到 NestJS 的 `AddLog` 端點。頁面下方的日誌歷史列表也將從後端獲取。
        

---

#### **階段 4: 報告與儀表板 (Reporting & Dashboards)**

此階段專注於數據分析與視覺化。

- **步驟 4.1: 數據準備與計算**
    
    - 在 NestJS 後端的 `CaseService` 中或直接在資料庫層級，準備好報告所需的計算邏輯（如「平均處理時長」）。
        
- **步驟 4.2: 建立應用程式內儀表板 (In-App Dashboard)**
    
    - 在 Next.js 中建立一個「報告」頁面，使用前端圖表函式庫 (例如 Chart.js 或 Recharts)，透過呼叫 NestJS 的報告 API 來獲取數據並呈現視覺化圖表。
        
- **步驟 4.3: 開發 Power BI (或其他 BI 工具) 詳細報告**
    
    - 讓 Power BI 或 Tableau 等 BI 工具，直接連接到專案的 PostgreSQL/MySQL 資料庫，進行更深入的數據分析與報告製作。
        
- **步驟 4.4: 整合報告**
    
    - 將發佈的 BI 報告嵌入到 Next.js 的「報告」頁面中，實現一站式數據查閱。
        

---

#### **階段 5: 測試、部署與交付 (Testing, Deployment & Handoff)**

此階段是確保應用程式品質、順利上線並交付給最終使用者的最後一哩路。

- **步驟 5.1: 使用者驗收測試 (UAT)**
    
    - 制定詳細的測試腳本，邀請真實使用者在電腦和手機上測試整個 Web 應用的功能流程，並收集回饋。
        
- **步驟 5.2: 錯誤修復與優化**
    
    - 開發團隊根據 UAT 的回饋，修復所有錯誤，並對 UI/UX 進行最後的調整。
        
- **步驟 5.3: 正式部署**
    
    - 此步驟將分為兩部分：
        
        1. **前端部署:** 將 **Next.js** 應用程式部署到 Vercel (官方推薦) 或其他支援 Node.js 的雲端平台。
            
        2. **後端部署:** 將 **NestJS** 應用程式打包成 Docker 映像檔，並部署到雲端伺服器 (如 AWS EC2, Google Cloud Run) 或 PaaS 平台 (如 Heroku)。
            
    - 設定生產環境的資料庫、檔案儲存及環境變數，並將網域名稱指向部署好的服務。
        
- **步驟 5.4: 專案交付**
    
    - 撰寫針對本應用的使用者手冊和管理員手冊。
        
    - 召開專案結束會議，正式將應用程式交付給業務方，並確認後續的維護和支援模式。