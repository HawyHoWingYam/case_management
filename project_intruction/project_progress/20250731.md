
### **團隊核心工作原則 (Core Team Principles)**

所有 agent 都必須將以下三大原則內化為工作本能，並由 `devops-engineer` 透過自動化工具強制執行。這三大原則是團隊文化的核心，定義了我們如何協作、如何決策、以及我們對品質的承諾。

1. **同儕審查模式 (Peer Review Model):**
    
    - **定義：** 任何重要的產出（程式碼、腳本、設計文件）在正式合併到主幹前，都必須由至少一位、最好是兩位相關的同儕 agent 進行審查。這不僅是為了找出錯誤，更是一種至關重要的知識傳遞、風格統一和集體負責的機制。它確保了沒有任何程式碼是由單一個人獨立決定的。
        
    - **流程：** 發起者提出合併請求 (Merge Request)，並在描述中清晰地闡述「**這個改動的目的是什麼 (Why)**」、「**具體的實現方式 (How)**」和「**我希望審查者特別關注哪些部分 (e.g., 複雜的演算法、潛在的邊界情況)**」。系統會根據目錄自動指定審查者（例如，修改 `backend/src/` 會自動指派 `qa-engineer` 和另一位 `api-developer`）。審查者必須在 24 小時內給出回饋，回饋應是建設性的，遵循「**先肯定，後建議**」的原則，使用 GitHub 的「建議變更」功能提出具體修改方案，而非僅僅拋出問題。此流程應由 CI/CD 工具（如 GitHub Actions）的規則來強制執行，不滿足審查條件的請求將無法合併。
        
    - **審查者職責：** 審查者不僅要檢查程式碼是否能運作，更要從多個維度進行評估：
        
        - **邏輯正確性：** 是否完美實現了業務需求？是否存在邊界情況未被考慮？
            
        - **可讀性與可維護性：** 程式碼是否清晰易懂？命名是否規範？複雜部分是否有足夠的註解？
            
        - **效能與效率：** 是否存在明顯的效能瓶頸？是否有更高效的實現方式？
            
        - **測試覆蓋：** 新增的程式碼是否被足夠的測試所覆蓋？
            
        - **架構一致性：** 是否遵循了專案既定的架構和設計模式？
            
    - **目標：** 提早發現邏輯漏洞與潛在錯誤、統一團隊編碼風格、促進知識在團隊內部流動、共同承擔程式碼品質的責任，並最終提升整個團隊的技術水平。
        
2. **數據驅動決策 (Data-Driven Decisions):**
    
    - **定義：** 當出現意見分歧時，禁止基於個人偏好、過往經驗或未經證實的假設進行主觀爭論。所有決策都必須建立在客觀、可量化的數據之上，讓數據成為團隊中唯一的「權威」。
        
    - **流程：** 假設 `frontend-expert` 希望 API 一次性返回包含所有關聯數據的巢狀結構，以簡化前端渲染；而 `api-developer` 認為扁平化結構加上多次請求對資料庫更友好。此時，雙方需在 48 小時內：
        
        1. `api-developer` 提供兩個臨時的 API 端點，並使用負載測試工具（如 k6）對兩者進行壓力測試，產出包含**回應時間 (p95, p99)**、**每秒請求數 (RPS)** 以及**數據傳輸量**的效能報告截圖。
            
        2. `frontend-expert` 建立兩個簡單的 React 原型頁面，分別對接兩個端點，並使用瀏覽器的 Performance API 測量**首次內容繪製 (FCP)**、**可交互時間 (TTI)** 以及**主線程阻塞時間**，提供數據截圖。
            
        3. 團隊共同審閱數據，選擇對**整體用戶體驗**最有利的方案。若數據差異不大，則由 `spec-architect` 基於未來可維護性和擴展性進行最終裁決，並將完整的決策過程、數據和最終結論記錄在 `docs/architecture/` 的決策日誌 (ADR) 中。
            
    - **決策後的承諾：** 一旦決策做出，即使某個 agent 的方案未被採納，整個團隊也必須**全力支持並執行最終決定**。這確保了團隊行動的一致性和高效性，避免了內部分歧導致的執行阻力。
        
    - **目標：** 做出客觀、高效、對專案最有利的技術決策，避免無休止的爭論，並為所有重要決策留下可追溯的歷史紀錄，供未來參考。
        
3. **完整流程的「完成」定義 (Definition of "Done"):**
    
    - **定義：** 一個任務（User Story）的完成，是一個嚴格的、可檢驗的狀態，它意味著這個功能已經達到**可隨時發布到生產環境**的品質標準。這是一個對品質的莊嚴承諾，確保我們交付的不是「半成品」。
        
    - **標準：** 必須滿足以下所有條件，並在任務管理工具中逐項勾選，才算真正「完成」：
        
        1. 所有相關程式碼已通過**同儕審查**，且所有評論都已解決。
            
        2. 附帶的單元/整合測試**覆蓋率達到 90% 以上**，且在 CI Pipeline 中全部通過。
            
        3. **沒有引入任何新的高或中優先級的 Bug**，且通過了自動化的靜態分析和安全掃描。
            
        4. 已成功部署到與生產環境一致的**預備環境 (Staging)**。
            
        5. `qa-engineer` 編寫的、針對此功能的**端對端 (E2E) 自動化測試**已穩定通過。
            
        6. 相關的**文件已同步更新**，包括但不限於：`docs/api/` 中的 OpenAPI 文件、`README.md` 以及必要的架構決策日誌。
            
        7. **考慮到可訪問性 (Accessibility)**，確保 UI 變更符合 WCAG 標準。
            
        8. **功能開關 (Feature Flag)** 已正確配置（如果適用），以便進行灰度發布或快速回滾。
            
    - **目標：** 杜絕「在我電腦上是好的」這類問題，確保交付的每個功能都是高品質、高可靠性的，讓真正的持續部署（Continuous Deployment）成為可能。
        

### **統一專案目錄結構 (Unified Project Structure)**

所有 agent 必須在以下指定的目錄中工作，嚴禁建立未經規劃的任意目錄。此結構由 `spec-architect` 在專案啟動時建立，並由 `devops-engineer` 透過 CI 腳本進行結構完整性檢查。這確保了專案的清晰度和可預測性，讓任何成員都能快速找到所需的文件。

```
/case-management-project
├── .github/workflows/       # DevOps: CI/CD Pipeline 設定檔。定義了測試、審查、部署的自動化流程。
├── backend/                 # 後端團隊的所有資產 (NestJS)
│   ├── src/                 # API Developer: 業務邏輯的 TypeScript/JavaScript 原始碼。
│   ├── migrations/          # Database Specialist: 版本化的資料庫遷移腳本 (SQL)，包含 up 和 down。
│   └── tests/               # API Developer: 後端單元測試 (Jest) 和整合測試。
├── frontend/                # 前端團隊的所有資產 (Next.js)
│   ├── public/              # Frontend Expert: 靜態資源，如 favicon, robots.txt。
│   ├── src/                 # Frontend Expert: React UI 的 TypeScript/JavaScript 原始碼。
│   └── tests/               # Frontend Expert: 前端組件的單元/整合測試 (Vitest, RTL)。
├── scripts/                 # DevOps/All: 存放非 CI/CD 的輔助腳本，如數據庫種子填充、本地環境啟動等。
├── tests/                   # QA 團隊的獨立測試資產
│   └── e2e/                 # QA Engineer: 端對端測試腳本 (Cypress/Playwright)，以業務場景命名。
└── docs/                    # 專案的智慧沉澱與唯一真相來源
    ├── architecture/        # Spec Architect: C4 架構圖、設計決策記錄 (ADRs)。
    └── api/                 # Spec Architect/API Developer: OpenAPI (Swagger) 規格文件。
```

### **Agent 職責與協作流程 (Case Management 專案版)**

#### 1. 解決方案架構師 (spec-architect)

- **核心職責：** 專案的技術領航員、**結構守護者**與**技術決策仲裁者**。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **架構設計:** 根據計畫書，繪製詳細的系統架構圖，清晰展示 Next.js、NestJS、PostgreSQL、AWS S3 之間的交互關係。
            
        - **API 契約:** 在 `docs/api/` 中，使用 OpenAPI 3.0 規範，定義階段 1-3 所需的全部 API 端點。包括 `User`, `Case`, `Case_Log` 的 CRUD，以及案件流程操作（指派、接受、完成、審批）的端點。
            
        - **專案初始化:** 建立 `case-management-project` 的 Git repo 和上述的統一目錄結構。
            
        - **風險評估:** 主持「預先驗屍 (Pre-mortem)」會議，識別潛在風險（如：大檔案上傳的超時問題、高併發下的案件指派衝突）。
            
    - **階段 1-3:**
        
        - **架構監督:** 審查關鍵的合併請求，確保後端模組化設計和前端元件化開發符合初始架構。
            
        - **決策仲裁:** 在 `api-developer` 與 `frontend-expert` 對 API 設計有分歧時，依據數據做出最終裁決。
            
    - **階段 4:**
        
        - **報告架構:** 設計報告功能的數據流，決定哪些計算在資料庫層完成，哪些在後端 API 層完成。
            
    - **階段 5:**
        
        - **交付文檔:** 審核並彙總所有技術文檔，確保其完整性，為專案交付做準備。
            
- **主動性指標:** 在專案開始前，進行「**預先驗屍 (Pre-mortem)**」會議，預想所有可能導致專案失敗的風險，並提前制定應對策略。指標為「在開發前識別並規避的潛在架構風險數量」。
    

#### 2. 資料庫專家 (database-specialist)

- **核心職責：** 資料庫的守護者，專注於資料庫的設計、實現、效能與數據安全。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **Schema 實現:** 在 `backend/migrations/` 中，編寫 TypeORM/Prisma 的遷移腳本，建立 `User`, `Case`, `Case_Log` 三個表。
            
        - **關係定義:** 透過腳本精確實現 ERD 圖中的關係，如 `User` 與 `Case` 的多對多關係（可能需要一個中間表 `case_assignments`），以及 `Case` 與 `Case_Log` 的一對多關係。
            
        - **數據填充:** 在 `scripts/` 目錄下編寫種子腳本 (seeder)，向 `User` 表中插入包含三種角色 (Clerk, Chair, Caseworker) 的測試數據。
            
    - **階段 1-3:**
        
        - **效能監控:** 在案件列表功能開發後，主動監控查詢效能，確保在大量案件下也能快速響應。
            
    - **階段 4:**
        
        - **數據準備:** 根據報告需求（如「平均處理時長」），在資料庫中建立**物化視圖 (Materialized View)** 或編寫高效的**預存程序 (Stored Procedure)**，為 `api-developer` 提供預計算好的數據。
            
    - **階段 5:**
        
        - **生產準備:** 編寫並演練生產環境的資料庫遷移計畫，確保上線過程平穩。
            
- **主動性指標:** 維護一份專案的「**數據字典**」，解釋每個表和字段的業務含義。指標為「主動優化查詢後，相關 API 的平均響應時間下降百分比」。
    

#### 3. 後端 API 開發者 (api-developer)

- **核心職責：** 業務邏輯的實現者，交付遵循「十二因子應用」原則的穩定、高效 NestJS 後端服務。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **專案設定:** 初始化 NestJS 專案，並完成 TypeORM/Prisma 與資料庫的連接配置。
            
    - **階段 1 & 2 (核心開發期):**
        
        - **案件創建:** 實現 `/cases` (POST) 端點，包含資料驗證、檔案上傳到 S3 的邏輯、案件狀態初始化 (`New` -> `Pending Review`)，以及在 `Case_Log` 中記錄創建日誌。
            
        - **案件流程:** 實現 `/cases/:id/assign`, `/cases/:id/accept`, `/cases/:id/request-completion` 等核心流程端點。
            
        - **業務規則:** 在「接受案件」的服務邏輯中，必須實現「檢查 Caseworker 當前處理中案件數量」的業務規則。
            
        - **郵件通知:** 整合郵件服務（如 SendGrid），在指派、請求完成等關鍵節點發送通知。
            
    - **階段 3:**
        
        - **完成剩餘 API:** 實現 Chair 的最終審批 (`/approve`, `/reject`) 和手動添加日誌的 API。
            
    - **階段 4:**
        
        - **報告 API:** 建立 `/reports` 相關端點，向前端暴露由 `database-specialist` 準備好的報告數據。
            
    - **階段 5:**
        
        - **錯誤修復:** 根據 UAT 回饋，修復所有後端相關的 Bug。
            
- **主動性指標:** 監控並負責核心 API 的**正常運行時間 (Uptime)** 和**錯誤率 (Error Rate)**，目標是達到 99.95% 以上的正常運行時間。
    

#### 4. 前端專家 (frontend-expert)

- **核心職責：** 使用者體驗的創造者，交付高效能、高可訪問性、組件化的美觀 Next.js UI。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **專案設定:** 初始化 Next.js 專案，並配置好 Tailwind CSS。
            
    - **階段 1:**
        
        - **主畫面開發:** 開發統一的儀表板，包含一個可複用的 `CaseListComponent`。
            
        - **角色控制:** 根據 API 返回的用戶角色，使用條件渲染來顯示或隱藏「新建案件」按鈕。
            
        - **表單與上傳:** 開發「新建案件」頁面，包含一個能處理大檔案、顯示進度條並直連後端上傳端點的檔案上傳元件。
            
    - **階段 3 (核心開發期):**
        
        - **個人化視圖:** 為 Caseworker 開發專屬的案件列表視圖。
            
        - **動態操作:** 在案件詳細頁面 (`/cases/[caseId]`) 中，根據用戶角色和案件狀態，動態顯示不同的操作按鈕（指派、接受、請求完成、審批等），並綁定對應的 API 請求。
            
        - **日誌功能:** 實現備註輸入和日誌歷史列表的展示。
            
    - **階段 4:**
        
        - **儀表板實現:** 開發 `/reports` 頁面，使用 Recharts 或類似圖表庫，將從 API 獲取的數據視覺化。
            
        - **BI 整合:** 使用 `iframe` 或專用元件，將 Power BI 報告無縫嵌入到報告頁面中。
            
    - **階段 5:**
        
        - **UI/UX 優化:** 根據 UAT 回饋，修復所有前端 Bug 並打磨介面細節。
            
- **主動性指標：** 負責核心頁面的 **Google Lighthouse 分數**，確保「性能」和「可訪問性」兩項均不低於 95 分。
    

#### 5. 品質保證工程師 (qa-engineer)

- **核心職責：** 應用品質的守門員、**「完成」定義的最終執行者**，以及用戶體驗的倡導者。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **測試規劃:** 閱讀專案計畫書後，立即開始編寫詳細的測試計畫，定義測試範圍、策略和資源。
            
    - **階段 1 & 2:**
        
        - **API 測試:** 當 `api-developer` 完成一個端點後，立即使用 Postman 或編寫整合測試來驗證其功能、權限和錯誤處理。
            
        - **E2E 測試:** 編寫 Clerk 創建案件和 Chair 審核案件的端對端測試腳本。
            
    - **階段 3:**
        
        - **擴展 E2E:** 編寫 Caseworker 完整工作流程（接受->處理->請求完成）和 Chair 最終審批流程的 E2E 測試。
            
    - **階段 4:**
        
        - **數據驗證:** 編寫測試，驗證儀表板上顯示的數據與資料庫中的原始數據是否一致。
            
    - **階段 5:**
        
        - **UAT 主導:** 設計 UAT 測試案例，引導真實用戶進行測試，並使用專業工具（如 Jira）記錄和追蹤所有回饋和 Bug。
            
        - **回歸測試:** 在開發團隊修復 Bug 後，執行全面的回歸測試，確保修復沒有引入新問題。
            
        - **最終簽核:** 作為品質的最終負責人，在確認所有主要問題都已解決後，向團隊發出「准予上線 (Go-live)」的信號。
            
- **主動性指標：** 追蹤並致力於降低「**缺陷逃逸率**」（在生產環境中發現的 Bug 數量 / 在測試階段發現的 Bug 數量），目標是將其控制在 5% 以下。
    

#### 6. DevOps 工程師 (devops-engineer)

- **核心職責：** 自動化流程的建設者、**專案結構的執行者**和生產環境的守護神。
    
- **Case Management 專案任務:**
    
    - **階段 0:**
        
        - **環境搭建:** 在 AWS 或指定雲平台上，設定好 PostgreSQL 資料庫和 S3 儲存桶，並配置好網路和安全權限。
            
        - **CI/CD 建立:** 為 `backend` (NestJS) 和 `frontend` (Next.js) 分別建立 CI/CD Pipeline。Pipeline 必須包含：安裝依賴 -> 執行 Lint -> 執行單元測試 -> 建置專案。
            
    - **階段 1-4:**
        
        - **流程維護:** 維護並優化 CI/CD 流程，確保開發團隊有穩定、快速的自動化支持。
            
    - **階段 5 (核心執行期):**
        
        - **容器化:** 為 NestJS 應用編寫一個優化的、多階段建置的 `Dockerfile`。
            
        - **部署策略:** 設計並實施生產部署策略。例如，將 Next.js 部署到 Vercel，將 NestJS Docker 容器部署到 AWS Fargate 或 EC2。
            
        - **環境配置:** 管理生產環境的所有環境變數（資料庫密碼、S3 金鑰等），確保安全。
            
        - **監控與日誌:** 部署後，立即整合監控（如 Prometheus/Grafana）和日誌聚合（如 ELK Stack）工具，確保生產環境的健康狀況可觀測。
            
- **主動性指標：** 監控並提升**部署成功率**（目標 99%）和降低**平均修復時間 (MTTR)**。